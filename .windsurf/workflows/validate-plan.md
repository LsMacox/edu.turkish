---
description: Валидация Плана
auto_execution_mode: 3
---

Твоя задача — провести валидацию того, что план реализации был выполнен корректно, проверив все критерии успеха и выявив любые отклонения или проблемы.

## Начальная Настройка

При вызове:

1.  **Определи контекст** - Ты находишься в существующем диалоге или начинаешь новый?
    - Если в существующем: Проанализируй, что было реализовано в этой сессии.
    - Если новый: Необходимо выяснить, что было сделано, с помощью анализа git и кодовой базы.

2.  **Найди план**:
    - Если путь к плану предоставлен, используй его.
    - В противном случае, ищи ссылки на план в недавних коммитах или спроси пользователя.

3.  **Собери доказательства реализации**:

    ```bash
    # Проверить недавние коммиты
    git log --oneline -n 20
    git diff HEAD~N..HEAD  # Где N покрывает коммиты реализации

    # Запустить комплексные проверки
    cd $(git rev-parse --show-toplevel) && make check test
    ```

## Процесс Валидации

### Шаг 1: Определение Контекста

Если начинаешь новый диалог или нужно больше контекста:

1.  **Полностью прочитай план реализации**.

2.  **Определи, что должно было измениться**:
    - Составь список всех файлов, которые должны быть изменены.
    - Отметь все критерии успеха (автоматические и ручные).
    - Определи ключевую функциональность для проверки.

3.  **Запусти параллельные задачи для исследования реализации**:

    ```
    Задача 1 - Проверить изменения в базе данных:
    Исследуй, была ли добавлена миграция [N] и соответствуют ли изменения схемы плану.
    Проверь: файлы миграций, версию схемы, структуру таблиц.
    Верни: Что было реализовано в сравнении с тем, что указано в плане.

    Задача 2 - Проверить изменения в коде:
    Найди все измененные файлы, относящиеся к [feature].
    Сравни фактические изменения со спецификациями плана.
    Верни: Пофайловое сравнение запланированного с фактическим.

    Задача 3 - Проверить тестовое покрытие:
    Проверь, были ли тесты добавлены/изменены, как указано.
    Выполни команды для запуска тестов и зафиксируй результаты.
    Верни: Статус тестов и любое отсутствующее покрытие.
    ```

### Шаг 2: Систематическая Валидация

Для каждого этапа в плане:

1.  **Проверь статус завершения**:
    - Ищи отметки о выполнении в плане (`- [x]`).
    - Убедись, что реальный код соответствует заявленному выполнению.

2.  **Выполни автоматическую проверку**:
    - Выполни каждую команду из раздела "Автоматическая Проверка".
    - Задокументируй статус прохождения/непрохождения.
    - В случае сбоев, исследуй первопричину.

3.  **Оцени ручные критерии**:
    - Составь список того, что требует ручного тестирования.
    - Предоставь четкие шаги для проверки пользователем.

4.  **Глубоко продумай крайние случаи (edge cases)**:
    - Обработаны ли условия ошибок?
    - Есть ли недостающие валидации?
    - Может ли реализация нарушить существующую функциональность?

### Шаг 3: Сгенерируй Отчет о Валидации

Создай исчерпывающий отчет о валидации:

```markdown
## Отчет о Валидации: [Plan Name]

### Статус Реализации

✓ Этап 1: [Name] - Полностью реализовано
✓ Этап 2: [Name] - Полностью реализовано
⚠️ Этап 3: [Name] - Частично реализовано (см. проблемы)

### Результаты Автоматической Проверки

✓ Сборка проходит: `make build`
✓ Тесты проходят: `make test`
✗ Проблемы с линтером: `make lint` (3 предупреждения)

### Результаты Ревью Кода

#### Соответствует Плану:

- Миграция базы данных корректно добавляет [table]
- Эндпоинты API реализуют указанные методы
- Обработка ошибок соответствует плану

#### Отклонения от Плана:

- Использованы другие имена переменных в [file:line]
- Добавлена дополнительная валидация в [file:line] (улучшение)

#### Потенциальные Проблемы:

- Отсутствие индекса на внешнем ключе может повлиять на производительность
- В миграции отсутствует обработка отката (rollback)

### Требуется Ручное Тестирование:

1. Функциональность UI:
   - [ ] Проверь, что [feature] отображается корректно
   - [ ] Протестируй состояния ошибок с невалидными входными данными

2. Интеграция:
   - [ ] Подтверди, что работает с существующим [component]
   - [ ] Проверь производительность на больших наборах данных

### Рекомендации:

- Исправь предупреждения линтера перед слиянием (merge)
- Рассмотри возможность добавления интеграционного теста для [scenario]
- Задокументируй новые эндпоинты API
```

## Работа с Существующим Контекстом

Если ты был частью реализации:

- Проанализируй историю диалога.
- Проверь свой список задач (todo list), чтобы увидеть, что было завершено.
- Сконцентрируй валидацию на работе, проделанной в этой сессии.
- Будь честен в отношении любых упрощений или незавершенных элементов.

## Важные Руководства

1.  **Будь тщательным, но практичным** - Сосредоточься на важном.
2.  **Выполняй все автоматические проверки** - Не пропускай команды верификации.
3.  **Документируй всё** - как успехи, так и проблемы.
4.  **Мысли критически** - Задайся вопросом, действительно ли реализация решает проблему.
5.  **Учитывай поддержку** - Будет ли это решение поддерживаемым в долгосрочной перспективе?

## Чек-лист Валидации

Всегда проверяй:

- [ ] Все этапы, отмеченные как завершенные, действительно выполнены.
- [ ] Автоматические тесты проходят.
- [ ] Код следует существующим паттернам.
- [ ] Не привнесены регрессии.
- [ ] Обработка ошибок надежна.
- [ ] Документация обновлена, если необходимо.
- [ ] Шаги для ручного тестирования понятны.

## Связь с Другими Командами

Рекомендуемый рабочий процесс:

1.  `/implement_plan` - Выполнить реализацию.
2.  `/commit` - Создать атомарные коммиты для изменений.
3.  `/validate_plan` - Проверить корректность реализации.

Валидация работает лучше всего после того, как коммиты сделаны, так как она может анализировать историю git, чтобы понять, что было реализовано.

Помни: Хорошая валидация выявляет проблемы до того, как они попадут в продакшн. Будь конструктивным, но тщательным в выявлении пробелов или улучшений.
