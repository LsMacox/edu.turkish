# Исследование кодовой базы

Ваша задача — провести комплексное исследование кодовой базы, используя существующую структуру `thoughts/` для контекста и сохранения результатов, и синтезировать их в единый подробный отчет.

## Начальная настройка:

Когда эта команда вызывается, ответьте:

```
Я готов к исследованию кодовой базы. Пожалуйста, предоставьте ваш исследовательский вопрос или интересующую область. Я проанализирую код и существующие заметки в 'thoughts/', чтобы дать исчерпывающий ответ.
```

Затем ожидайте исследовательский запрос от пользователя.

## Шаги для выполнения после получения запроса:

1.  **Сначала проанализируйте напрямую упомянутые файлы:**
    - Если пользователь упоминает конкретные файлы, используйте команду `@file` для каждого из них, чтобы загрузить их полный контекст.
    - **КРИТИЧЕСКИ ВАЖНО**: Сделайте это в первую очередь, до составления плана, чтобы получить полный первоначальный контекст.

2.  **Проанализируйте запрос и создайте план исследования:**
    - Разбейте запрос пользователя на логические шаги.
    - Подумайте, какие компоненты, функции или концепции нужно исследовать.
    - **Создайте план исследования в виде чек-листа.** Это сделает процесс прозрачным. Например:
      - `[ ]` Найти определения и использование `User` в коде.
      - `[ ]` Найти связанные документы в `thoughts/researches/` и `thoughts/plans/` по теме "user".
      - `[ ]` Проанализировать, как используется компонент `UserProfile`.
      - `[ ]` Изучить API-эндпоинты, возвращающие данные о пользователе.

3.  **Выполните план исследования:**
    - Последовательно выполняйте шаги из вашего плана.
    - **Для поиска по коду** используйте `@-команды` Cursor: `@file`, `@MyClass`, `@myFunction`.
    - **Для поиска исторического контекста** используйте `@file` для поиска релевантных файлов внутри всей директории `thoughts/`. Уделите особое внимание `thoughts/researches/`, `thoughts/plans/` и `thoughts/drafts/`.
    - Для каждого шага кратко описывайте свои находки, включая пути к файлам и номера строк.

4.  **Синтезируйте итоговые результаты:**
    - После завершения всех шагов соберите все полученные результаты.
    - Приоритизируйте информацию из **активной кодовой базы** как основной источник истины.
    - Используйте содержимое директории `thoughts/` (включая `researches/`, `plans/` и `drafts/`) для сбора **исторического контекста**, прошлых решений и планов.
    - Свяжите находки из разных компонентов, выделите паттерны, связи и архитектурные решения.

5.  **Соберите метаданные для исследовательского отчета:**
    - Используйте встроенный терминал для сбора информации о репозитории:
      - **Хэш коммита:** `git rev-parse HEAD`
      - **Имя ветки:** `git branch --show-current`
      - **Имя репозитория:** `basename -s .git $(git config --get remote.origin.url)`
    - Подготовьте имя файла для отчета, используя вашу структуру: `thoughts/researches/YYYY-MM-DD_HH-MM-SS_topic.md`.

6.  **Сгенерируйте исследовательский отчет:**
    - Создайте новый файл по пути, сгенерированному на шаге 5.
    - Структурируйте документ, используя `YAML frontmatter` и последующее содержание:

    ```markdown
    ---
    date: [Текущая дата и время в формате ISO 8601]
    researcher: Gemini 2.5 Pro (via Cursor)
    git_commit: [Хэш коммита]
    branch: [Имя ветки]
    repository: [Имя репозитория]
    topic: '[Вопрос/Тема пользователя]'
    tags: [research, codebase, релевантные-имена-компонентов]
    status: complete
    last_updated: [Текущая дата в формате YYYY-MM-DD]
    last_updated_by: Gemini 2.5 Pro (via Cursor)
    ---

    # Исследование: [Вопрос/Тема пользователя]

    ## Исследовательский вопрос

    > [Оригинальный запрос пользователя]

    ## Краткое изложение

    [1-2 абзаца с общими выводами, отвечающими на вопрос пользователя.]

    ## Подробные результаты из кодовой базы

    ### [Компонент/Область 1]

    - Результат со ссылкой на файл и строку.
    - Детали реализации и ключевые фрагменты кода.

    ### [Компонент/Область 2]

    ...

    ## Исторический контекст (из `thoughts/`)

    [Релевантные инсайты и ссылки на документы из `thoughts/researches/`, `thoughts/plans/` и `thoughts/drafts/`.]

    - Ссылка на прошлое исследование: `thoughts/researches/2023-10-15_auth_system.md`
    - Ссылка на связанный план: `thoughts/plans/Q4-2023_new_user_profile.md`

    ## Ключевые ссылки на код

    - `src/path/to/file.py:123` — Описание того, что находится в этой строке.
    - `src/another/file.ts:45-67` — Описание этого блока кода.

    ## Архитектурные инсайты

    [Обнаруженные паттерны, соглашения и общие проектные решения.]

    ## Открытые вопросы

    [Любые области, требующие дальнейшего исследования, или неясности.]
    ```

7.  **Сгенерируйте постоянные ссылки (permalinks) на GitHub (если применимо):**
    - Во встроенном терминале проверьте, что коммит запушен (`git status`).
    - Если возможно, получите информацию о репозитории: `gh repo view --json owner,name`.
    - В сгенерированном отчете замените локальные ссылки на код (`src/path/to/file.py:123`) на постоянные ссылки GitHub: `https://github.com/{owner}/{repo}/blob/{commit}/{file}#L{line}`.

8.  **Представьте результаты пользователю:**
    - Выведите в чат краткое изложение из раздела "Краткое изложение" отчета.
    - Включите несколько ключевых ссылок на файлы из кода и из `thoughts/` для удобной навигации пользователя.
    - Завершите ответ вопросом: "Я сохранил полный отчет в `thoughts/researches/`. Это отвечает на ваш вопрос? Нужны ли какие-либо уточнения?"

9.  **Обработайте дополнительные вопросы:**
    - Если у пользователя есть дополнительные вопросы, **найдите и обновите существующий исследовательский документ** в `thoughts/researches/`.
    - Обновите поля `frontmatter`: `last_updated`, `last_updated_by` и добавьте новое поле `last_updated_note: "Добавлено исследование по теме [краткое описание]"`.
    - Добавьте в отчет новый раздел: `## Дополнительное исследование [timestamp]`.
    - Представьте обновленную информацию пользователю.

## Важные замечания:

- **Используйте `thoughts/`**: Эта директория — ваш главный источник исторического контекста. Новые отчеты всегда сохраняются в `thoughts/researches/`.
- **Свежее исследование**: Всегда проводите исследование актуальной кодовой базы. Документы в `thoughts/` служат дополнением, а не заменой.
- **Конкретика**: Фокусируйтесь на точных путях к файлам и номерах строк. Это наиболее ценно для разработчиков.
- **Согласованность `frontmatter`**: Всегда используйте `YAML frontmatter` с полями в `snake_case` (например, `last_updated`). Это делает документы машиночитаемыми.
- **Терминал**: Активно используйте встроенный терминал для получения метаданных (`git`, `gh`).
