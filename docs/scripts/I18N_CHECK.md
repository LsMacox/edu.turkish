# Проверка качества переводов (`scripts/i18n-check.ts`)

Скрипт анализирует JSON-файлы в `i18n/locales` и сообщает о распространённых проблемах: дубликаты ключей, неиспользуемые строки, пропущенные переводы и пустые структуры. Вывод адаптирован под людей и инструменты автоматизации.

## Предварительные требования

- Node.js 18+
- Установленные зависимости (`npm install`)
- Актуальные файлы локалей в `i18n/locales/{en,ru,kk,tr}`

## Запуск

```bash
# рекомендуемый способ
npm run i18n:check

# напрямую
npx tsx scripts/i18n-check.ts [--опции]
```

## Опции

- `--verbose` — подробный вывод прогресса (сколько файлов загружено, сколько ключей найдено).
- `--json` — вывод отчёта в формате JSON (подходит для CI или постобработки).
- `--remove-unused` — после интерактивного подтверждения удаляет найденные неиспользуемые ключи.
- `--remove-empty` — удаляет пустые структуры (объекты без значений). Требует подтверждения.

## Что проверяется

| Категория | Описание |
| --- | --- |
| Дубликаты | Один и тот же ключ встречается в разных файлах одной локали |
| Неиспользуемые | Ключ определён в переводах, но не найден в коде (`t`, `$t`, `te`, `tm`) |
| Отсутствующие | Ключ есть в одной или нескольких локалях, но отсутствует в других |
| Пустые структуры | Объект содержит только вложенные пустые объекты без значений |

> ⚠️ Динамически составленные ключи (например, ``t(`pages.${page}.title`)``) могут не распознаться. Проверяйте отчёт вручную перед удалением ключей.

## Пример вывода

```text
[duplicates]
  ✖ common.submit — ru (i18n/locales/ru/common.json ↔ i18n/locales/ru/components/forms.json)

[unused]
  ⚠ pages.old_feature.title — en (i18n/locales/en/pages/old_feature.json)

[missing]
  ✖ pages.new_feature.cta — отсутствует в: tr

[empty]
  ⚠ faq.documents.q1 — en (i18n/locales/en/pages/faq.json)

Summary: 9 issues (2 duplicates, 3 unused, 2 missing, 2 empty)
```

Для JSON-режима (`--json`) возвращается объект с полями `duplicateIssues`, `unusedIssues`, `missingIssues`, `emptyStructureIssues` и `summary`.

## Поведение и коды возврата

- Скрипт завершает работу с кодом `0`, даже если найдены проблемы — цель уведомить, а не завалить сборку.
- Код `1` означает ошибку выполнения (невалидный JSON, отсутствующая директория и т.п.).

## Удаление ключей

При использовании `--remove-unused` или `--remove-empty` скрипт выводит список изменений и спрашивает подтверждение. Рекомендуется сделать коммит перед запуском и просмотреть diff после выполнения.

## Устранение неполадок

| Сообщение | Действие |
| --- | --- |
| `Failed to parse ...` | Проверьте JSON через `jq '.' <file>` или редактор с подсветкой ошибок |
| `Locale directory not found` | Убедитесь, что директории `i18n/locales/{en,ru,kk,tr}` существуют |
| `No locale files found` | Проверьте, что запускаете скрипт из корня репозитория |

