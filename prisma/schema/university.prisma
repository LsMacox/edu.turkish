// Prisma Schema - University Domain
// Core university model and related entities

model University {
  id                    Int            @id @default(autoincrement())
  countryId             Int?
  cityId                Int?
  foundedYear           Int?           @map("founded_year")
  type                  UniversityType @default(state)
  tuitionMin            Decimal?       @map("tuition_min") @db.Decimal(10, 2)
  tuitionMax            Decimal?       @map("tuition_max") @db.Decimal(10, 2)
  currency              String?        @default("USD") @db.VarChar(3)
  totalStudents         Int?           @map("total_students")
  internationalStudents Int?           @map("international_students")
  rankingScore          Int?
  hasAccommodation      Boolean        @default(false) @map("has_accommodation")
  hasScholarships       Boolean        @default(false) @map("has_scholarships")
  heroImage             String?        @map("hero_image") @db.VarChar(500)
  image                 String?        @db.VarChar(500)
  createdAt             DateTime       @default(now()) @map("created_at")
  updatedAt             DateTime       @updatedAt @map("updated_at")

  // Relations
  translations          UniversityTranslation[]
  academicPrograms      UniversityProgram[]
  reviews               UniversityReview[]
  campusFacilities      UniversityCampusFacility[]
  admissionRequirements UniversityAdmissionRequirement[]
  requiredDocuments     UniversityRequiredDocument[]
  importantDates        UniversityImportantDate[]
  scholarships          UniversityScholarship[]
  universityDirections  UniversityStudyDirection[]
  media                 UniversityMediaAsset[]
  country               Country?                         @relation(fields: [countryId], references: [id], onDelete: SetNull)
  city                  City?                            @relation(fields: [cityId], references: [id], onDelete: SetNull)

  // Unused indexes removed:
  // - hasAccommodation, hasScholarships (boolean, not filtered)
  // - foundedYear, totalStudents, internationalStudents (not filtered)
  // - countryId (not used in current queries)
  // - compound tuition index (separate indexes more flexible)

  // Active indexes (used in queries)
  @@index([type], map: "idx_university_type")
  @@index([cityId], map: "idx_university_city")
  @@index([tuitionMin], map: "idx_university_tuition_min")
  @@index([tuitionMax], map: "idx_university_tuition_max")
  @@index([rankingScore], map: "idx_university_ranking_score")
  @@map("universities")
}

model UniversityTranslation {
  id           Int      @id @default(autoincrement())
  universityId Int      @map("university_id")
  locale       String   @db.VarChar(5)
  title        String?  @db.VarChar(255)
  description  String?  @db.Text
  slug         String   @db.VarChar(255)
  about        Json?
  keyInfoTexts Json?    @map("key_info_texts")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  university University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@unique([universityId, locale], name: "unique_translation")
  @@unique([locale, slug], name: "unique_university_slug_per_locale")
  @@index([locale], map: "idx_university_translation_locale")
  @@map("university_translations")
}

// ==========================================
// University Media
// ==========================================

model UniversityMediaAsset {
  id           Int       @id @default(autoincrement())
  universityId Int       @map("university_id")
  kind         MediaKind @map("kind")
  url          String    @db.VarChar(500)
  thumbnailUrl String?   @map("thumbnail_url") @db.VarChar(500)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  // Relations
  university   University                        @relation(fields: [universityId], references: [id], onDelete: Cascade)
  translations UniversityMediaAssetTranslation[]

  @@index([universityId], map: "idx_media_university")
  @@index([universityId, kind], map: "idx_media_university_kind")
  @@map("university_media_assets")
}

model UniversityMediaAssetTranslation {
  id        Int      @id @default(autoincrement())
  mediaId   Int      @map("university_media_asset_id")
  locale    String   @db.VarChar(5)
  title     String?  @db.VarChar(255)
  alt       String?  @db.VarChar(255)
  caption   String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  media UniversityMediaAsset @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([mediaId, locale])
  @@map("university_media_asset_translations")
}

// ==========================================
// Academic Programs
// ==========================================

model UniversityProgram {
  id             Int        @id @default(autoincrement())
  universityId   Int        @map("university_id")
  degreeType     DegreeType @map("degree_type")
  languageCode   String     @db.VarChar(5)
  durationYears  Int        @map("duration_years")
  tuitionPerYear Decimal    @map("tuition_per_year") @db.Decimal(10, 2)
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")

  // Relations
  university   University                     @relation(fields: [universityId], references: [id], onDelete: Cascade)
  translations UniversityProgramTranslation[]

  @@index([universityId, degreeType], map: "idx_program_university_degree")
  @@index([languageCode], map: "idx_program_language")
  @@index([tuitionPerYear], map: "idx_program_tuition")
  @@index([universityId, languageCode], map: "idx_program_university_language")
  @@map("university_programs")
}

model UniversityProgramTranslation {
  id        Int      @id @default(autoincrement())
  programId Int      @map("university_program_id")
  locale    String   @db.VarChar(5)
  name      String?  @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  program UniversityProgram @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@unique([programId, locale])
  @@map("university_program_translations")
}

// ==========================================
// Campus Facilities
// ==========================================

model UniversityCampusFacility {
  id           Int      @id @default(autoincrement())
  universityId Int      @map("university_id")
  image        String?  @db.VarChar(500)
  isActive     Boolean  @default(true) @map("is_active")
  icon         String?  @db.VarChar(100)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  university   University                            @relation(fields: [universityId], references: [id], onDelete: Cascade)
  translations UniversityCampusFacilityTranslation[]

  @@index([universityId, isActive], map: "idx_facility_filters")
  @@map("university_campus_facilities")
}

model UniversityCampusFacilityTranslation {
  id          Int      @id @default(autoincrement())
  facilityId  Int      @map("university_campus_facility_id")
  locale      String   @db.VarChar(5)
  name        String?  @db.VarChar(255)
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  facility UniversityCampusFacility @relation(fields: [facilityId], references: [id], onDelete: Cascade)

  @@unique([facilityId, locale])
  @@map("university_campus_facility_translations")
}

// ==========================================
// Admission Requirements
// ==========================================

model UniversityAdmissionRequirement {
  id           Int      @id @default(autoincrement())
  universityId Int      @map("university_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  university   University                                  @relation(fields: [universityId], references: [id], onDelete: Cascade)
  translations UniversityAdmissionRequirementTranslation[]

  @@index([universityId], map: "idx_requirement_university")
  @@map("university_admission_requirements")
}

model UniversityAdmissionRequirementTranslation {
  id            Int      @id @default(autoincrement())
  requirementId Int      @map("university_admission_requirement_id")
  locale        String   @db.VarChar(5)
  category      String?  @db.VarChar(100)
  requirement   String?  @db.VarChar(255)
  details       String?  @db.Text
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  admissionRequirement UniversityAdmissionRequirement @relation(fields: [requirementId], references: [id], onDelete: Cascade)

  @@unique([requirementId, locale])
  @@map("university_admission_requirement_translations")
}

// ==========================================
// Required Documents
// ==========================================

model UniversityRequiredDocument {
  id           Int      @id @default(autoincrement())
  universityId Int      @map("university_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  university   University                              @relation(fields: [universityId], references: [id], onDelete: Cascade)
  translations UniversityRequiredDocumentTranslation[]

  @@index([universityId], map: "idx_document_university")
  @@map("university_required_documents")
}

model UniversityRequiredDocumentTranslation {
  id                 Int      @id @default(autoincrement())
  documentId         Int      @map("university_required_document_id")
  locale             String   @db.VarChar(5)
  name               String?  @db.VarChar(255)
  description        String?  @db.Text
  formatRequirements Json?    @map("format_requirements")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  // Relations
  document UniversityRequiredDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@unique([documentId, locale])
  @@map("university_required_document_translations")
}

// ==========================================
// Important Dates
// ==========================================

model UniversityImportantDate {
  id           Int               @id @default(autoincrement())
  universityId Int               @map("university_id")
  date         DateTime          @db.Date
  type         ImportantDateType
  createdAt    DateTime          @default(now()) @map("created_at")
  updatedAt    DateTime          @updatedAt @map("updated_at")

  // Relations
  university   University                           @relation(fields: [universityId], references: [id], onDelete: Cascade)
  translations UniversityImportantDateTranslation[]

  @@index([universityId, type, date], map: "idx_date_filters")
  @@index([date], map: "idx_date_upcoming")
  @@map("university_important_dates")
}

model UniversityImportantDateTranslation {
  id        Int      @id @default(autoincrement())
  dateId    Int      @map("university_important_date_id")
  locale    String   @db.VarChar(5)
  event     String?  @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  importantDate UniversityImportantDate @relation(fields: [dateId], references: [id], onDelete: Cascade)

  @@unique([dateId, locale])
  @@map("university_important_date_translations")
}

// ==========================================
// Scholarships
// ==========================================

model UniversityScholarship {
  id                  Int             @id @default(autoincrement())
  universityId        Int             @map("university_id")
  type                ScholarshipType
  coveragePercentage  Int             @map("coverage_percentage")
  applicationDeadline DateTime?       @map("application_deadline") @db.Date
  createdAt           DateTime        @default(now()) @map("created_at")
  updatedAt           DateTime        @updatedAt @map("updated_at")

  // Relations
  university   University                         @relation(fields: [universityId], references: [id], onDelete: Cascade)
  translations UniversityScholarshipTranslation[]

  @@index([universityId, type], map: "idx_scholarship_type")
  @@index([coveragePercentage], map: "idx_scholarship_coverage")
  @@index([applicationDeadline], map: "idx_scholarship_deadline")
  @@map("university_scholarships")
}

model UniversityScholarshipTranslation {
  id                  Int      @id @default(autoincrement())
  scholarshipId       Int      @map("university_scholarship_id")
  locale              String   @db.VarChar(5)
  name                String?  @db.VarChar(255)
  eligibilityCriteria Json?    @map("eligibility_criteria")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  // Relations
  scholarship UniversityScholarship @relation(fields: [scholarshipId], references: [id], onDelete: Cascade)

  @@unique([scholarshipId, locale])
  @@map("university_scholarship_translations")
}

// ==========================================
// Study Directions
// ==========================================

model StudyDirection {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  universityDirections UniversityStudyDirection[]
  translations         StudyDirectionTranslation[]

  @@map("study_directions")
}

model UniversityStudyDirection {
  id           Int      @id @default(autoincrement())
  universityId Int      @map("university_id")
  directionId  Int      @map("study_direction_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  university University     @relation(fields: [universityId], references: [id], onDelete: Cascade)
  direction  StudyDirection @relation(fields: [directionId], references: [id], onDelete: Cascade)

  @@unique([universityId, directionId])
  @@index([directionId], map: "idx_pivot_direction")
  @@map("university_pivot_study_directions")
}

model StudyDirectionTranslation {
  id          Int      @id @default(autoincrement())
  directionId Int      @map("study_direction_id")
  locale      String   @db.VarChar(5)
  name        String?  @db.VarChar(255)
  slug        String   @db.VarChar(255)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  direction StudyDirection @relation(fields: [directionId], references: [id], onDelete: Cascade)

  @@unique([directionId, locale])
  @@unique([locale, slug], name: "unique_direction_slug_per_locale")
  @@map("study_direction_translations")
}
