// Prisma Schema - Blog Domain
// Blog articles and categories with translations

// import { BlogArticleStatus } from "./base"

model BlogCategory {
  id        Int       @id @default(autoincrement())
  code      String    @db.VarChar(64)
  order     Int?      @db.SmallInt
  /// Флаг для категорий направлений (programs), отделяет их от обычных категорий блога
  isProgram Boolean   @default(false) @map("is_program")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  // Relations
  translations BlogCategoryTranslation[]
  articles     BlogArticle[]

  @@unique([code])
  @@index([isProgram], map: "idx_blog_category_is_program")
  @@map("blog_categories")
}

model BlogCategoryTranslation {
  id         Int      @id @default(autoincrement())
  categoryId Int      @map("category_id")
  locale     String   @db.VarChar(5)
  title      String   @db.VarChar(255)

  // Relations
  category BlogCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, locale])
  @@map("blog_category_translations")
}

model BlogArticle {
  id                 Int                @id @default(autoincrement())
  categoryId         Int                @map("category_id")
  status             BlogArticleStatus  @default(published)
  isFeatured         Boolean            @default(false) @map("is_featured")
  isPowerPage        Boolean            @default(false) @map("is_power_page")
  /// Флаг для статей-направлений, отображаются по URL /program/[slug] вместо /articles/[slug]
  isProgram          Boolean            @default(false) @map("is_program")
  publishedAt        DateTime           @map("published_at")
  coverImage         String?            @map("cover_image") @db.VarChar(500)
  heroImage          String?            @map("hero_image") @db.VarChar(500)
  readingTimeMinutes Int?               @map("reading_time_minutes")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")

  // Relations
  category     BlogCategory           @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  translations BlogArticleTranslation[]

  @@index([categoryId], map: "idx_blog_article_category")
  @@index([publishedAt], map: "idx_blog_article_published_at")
  @@index([isProgram], map: "idx_blog_article_is_program")
  @@map("blog_articles")
}

model BlogArticleTranslation {
  id             Int         @id @default(autoincrement())
  articleId      Int         @map("article_id")
  locale         String      @db.VarChar(5)
  slug           String      @db.VarChar(255)
  title          String      @db.VarChar(255)
  excerpt        String?     @db.VarChar(500)
  readingTime    String?     @map("reading_time") @db.VarChar(50)
  heroKicker     String?     @map("hero_kicker") @db.VarChar(120)
  heroSubtitle   String?     @map("hero_subtitle") @db.VarChar(500)
  heroLocation   String?     @map("hero_location") @db.VarChar(120)
  imageAlt       String?     @map("image_alt") @db.VarChar(255)
  heroImageAlt   String?     @map("hero_image_alt") @db.VarChar(255)
  seoDescription String?     @map("seo_description") @db.VarChar(500)
  content        Json?       @db.Json
  quickFacts     Json?       @map("quick_facts") @db.Json
  tags           Json?       @db.Json
  createdAt      DateTime    @default(now()) @map("created_at")
  updatedAt      DateTime    @updatedAt @map("updated_at")

  // Relations
  article BlogArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, locale])
  @@unique([locale, slug], name: "unique_blog_article_slug_per_locale")
  @@map("blog_article_translations")
}
